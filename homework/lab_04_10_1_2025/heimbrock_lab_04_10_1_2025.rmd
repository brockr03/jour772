---
title: "lab_04_update"
author: "Bex Heimbrock"
date: "2025-10-03"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## About this lab

To complete this lab, you need to: \* run existing code as directed (look for **Task**). \* modify existing code as directed (look for **Task**). \* write code in empty codeblocks provided to answer questions included (look for **Q**). \* write out the answer in the form of a complete sentence in the space given (look for **A**).

When you are finished, commit changes and push to your personal GitHub repo, then submit the URL to this document on ELMS.

## Load libraries and establish settings

You'll need to load three packages for this: the tidyverse, lubridate, refinr and janitor.

**Task** load these four packages.

```{r}
# Turn off scientific notation
options(scipen=999)

# load your packages
library(tidyverse)
library(lubridate)
library(refinr) 
library(janitor)

```

For this lab, we want to investigate spending by Maryland state and local candidates during the 2022 election. For example, we could ask how much money have candidates and committees spent on advertising on Facebook? Which vendors received the most money for media expenses? We have the data, but it's messy - names of payees are spelled differently and capitalized differently - and we need to clean it up. 


## Load Data

You'll need to load one data set, a CSV file of Maryland campaign expenditures located in the data folder called "maryland_expenses.csv"

**Task** Create a codeblock below, then read the data in and assign it to an appropriate variable name. 
--Use janitor to clean the column names
--Convert dates into date values

```{r}
#maryland expenses csv file 
md_expenses <- read_csv("data/maryland_expenses.csv") |> 
clean_names()

```

## Answer questions

**Q1.** You've been assigned to write about Maryland political committees' use of Facebook advertising. There's a category column in the data that has values for different kinds of spending. One of them is "Media". You'll need to complete the following steps:

a.  Create a dataframe filtered for just Media expenses.
b.  Create a `payee_clean` column and standardize the data from `payee_name` using the `n_gram_merge' command

**A1:** YOUR CODE HERE
```{r}
media_category <- md_expenses |> filter(expense_category == "Media")

head(media_category) 

cleaned_media_category <- md_expenses |>
mutate(payee_clean=n_gram_merge(payee_name)) |>
select(payee_name, payee_clean, everything ())
```


**Q2** More cleaning of Facebook. Look carefully at variations of Facebook, bearing in mind that it changed its name in 2021: <https://about.fb.com/news/2021/10/facebook-company-is-now-meta/>).

Create a new object called `expenses_summary` 
Using case_when, create a column called `payee_FB` that will standardize all the variations on Facebook and **its parent company** in the data. 
Filter the data in `payee_FB` for all of the standardized Facebook items.
Then calculate the total amount of Facebook spending by each committee and present the results showing the committee that spent the most first.

**A**: YOUR CODE HERE
```{r}
expenses_summary <- cleaned_media_category |>
  mutate(
    payee_FB = case_when(
      str_detect(payee_clean, regex("facebook|meta platforms|meta", ignore_case = TRUE)) ~ "Meta",
      TRUE ~ NA_character_
    )
  ) |>
  filter(payee_FB == "Meta") |>
  group_by(committee_name) |>
  summarise(total_spent = sum(amount, na.rm = TRUE)) |>
  arrange(desc(total_spent))

#Note that I consulted an AI tool to help figure out this code. 
```

**Q3.** Let's do some research on the top committees from question 1. Look up the top 10 spenders: if they are candidate committees, what offices were they running for? 

** WRITE THE ANSWER**
**A3.** Friends Of Jennifer Johnson is one of the top spenders, she is an ambassador to Micronesia but was running for the house of representatives. Another top donor is Sen. Johnny Ray Salling. Herb McMillan, another top donor, is a former MD State Delegate. 

**Q4.** Given the list of top spenders and the primary results for governor (<https://elections.maryland.gov/elections/2022/primary_results/gen_results_2022_1.html>), who is missing from that list? 

**A4**: YOUR CODE HERE
```{r}
primary_winner_best <- cleaned_media_category |>
  group_by(payee_name, fundtype, amount, committee_name) |>
  summarise(count = n(), .groups = "drop") |>
  filter(
    str_detect(str_to_lower(committee_name), "maryland slate")
  ) |>
  arrange(desc(amount))
#I used an AI tool to help with the syntax here. I had missing stringers.  It also added the .groups function.
```

**a.** Who are the biggest recipients of media expenses by the Democratic primary winner for governor? Hint: that person has two committees, the second one with his running mate.
** WRITE THE ANSWER**
Moore Miller for Maryland Slate

**b.** Describe the business of the top recipient.
** WRITE THE ANSWER**
The top recipient's business is SKDK, a PR solutions firm for candidates. 

**Q5.** Examine the standardized purpose column in the media expenses data. Write code to generate a list of the committees with the total amount of spending on online advertising. 

--How does this list compare to the list you already generated about top Facebook spenders? 
--Of the top 5 committees who spent the most on Facebook ads from the first list, are there any that appear to have spent *all* of their online advertising dollars on Facebook?

This list is much shorter and, as a result, easier to make sense of. It also focuses specifically on political spending and campaign expenditures. Jasani Salima appears to have spent all online advertising dollars on Facebook which is an ... interesting method of marketing.

**A5.**YOUR CODE HERE


```{r}

purpose_spending <- cleaned_media_category |>
  group_by(expense_purpose, committee_name, payee_clean) |>
  summarise(
    total_amount = sum(amount, na.rm = TRUE),
    count = n(),
    .groups = "drop"
  ) |>
  filter(
    str_detect(str_to_lower(payee_clean), "meta")
  ) |>
  arrange(desc(total_amount))

#I used an AI tool to help me figure this out. My original code didn't match uppercase/lowercase variables, and it was being rendered redundant by the summarise count function.
```

**Q6** Your editor asks you to summarize your findings about spending on Facebook by Maryland political candidates. How much do we know and what don't we know? What's the best story idea you've found here?

**A6** ** WRITE THE ANSWER**

So, we know that Wes Moore's campaign was the top democratic spender for Facebook in the gubernatorial race. We also know that, in general, candidates are spending a LOT on Facebook/Meta marketing, to the extent that one candidate -- Jasani Salima -- devoted all of her social media campaign spending to Facebook/Meta. One question I have is, since Meta now also owns Instagram, how do we know that the expenditures labeled Meta are only for Facebook? I'd like to see whether the expenses paid off -- what is their audience data like? Did the spending correlate to an increase in real-life votes? I think that question would make the best story. 
